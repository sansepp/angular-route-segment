/**
 * angular-route-segment 1.5.1
 * https://angular-route-segment.com
 * @author Artem Chivchalov
 * @license MIT License http://opensource.org/licenses/MIT
 */

"use strict";!function(e){var n=e.module("route-segment",[]);n.provider("$routeSegment",["$routeProvider",function(n){function t(e){return e.replace(/([\:\-\_]+(.))/g,function(e,n,t,r){return r?t.toUpperCase():t})}function r(e,n){if(!e)throw new Error("Invalid pointer segment");var a;return{segment:function(n,r){return e[t(n)]={name:n,params:r},a=n,this},within:function(n){var o;if(n=n||a,o=e[t(n)])void 0==o.children&&(o.children={});else{if(i.strictMode)throw new Error("Cannot get into unknown `"+n+"` segment");o=e[t(n)]={params:{},children:{}}}return r(o.children,this)},up:function(){return n},root:function(){return u}}}var a=this,i=a.options={autoLoadTemplates:!0,strictMode:!1},o=this.segments={},u=r(o,null),c={};a.when=function(e,t,r){return void 0==r&&(r={}),r.segment=t,n.when(e,r),c[t]=e,this},e.extend(a,u),this.$get=["$rootScope","$q","$http","$templateCache","$route","$routeParams","$injector",function(n,r,a,u,l,s,m){function h(n){var t=!1;return n.params.dependencies&&e.forEach(n.params.dependencies,function(n){e.equals(d.$routeParams[n],s[n])||(t=!0)}),t}function f(e,n){return d.chain[e]&&d.chain[e].clearWatcher&&d.chain[e].clearWatcher(),n?($[e]=n.name,n.params.untilResolved?g(e,n.name,n.params.untilResolved).then(function(t){return void 0!=t.success&&p(e),g(e,n.name,n.params)}):g(e,n.name,n.params)):($[e]=null,void p(e))}function g(t,o,c){var l=e.extend({},c.resolve);return e.forEach(l,function(n,t){l[t]=e.isString(n)?m.get(n):m.invoke(n)}),c.template&&(l.$template=c.template,e.isFunction(l.$template)&&(l.$template=m.invoke(l.$template))),i.autoLoadTemplates&&c.templateUrl&&(l.$template=c.templateUrl,e.isFunction(l.$template)&&(l.$template=m.invoke(l.$template)),l.$template=a.get(l.$template,{cache:u}).then(function(e){return e.data})),r.all(l).then(function(a){if($[t]!=o)return r.reject();if(d.chain[t]={name:o,params:c,locals:a,reload:function(){var e=v(t,d.name.split("."));f(t,e).then(function(n){void 0!=n.success&&(p(t),e.children&&p(t+1))})}},c.watcher){var i=function(){if(!e.isFunction(c.watcher)&&!e.isArray(c.watcher))throw new Error("Watcher is not a function in segment `"+o+"`");return m.invoke(c.watcher,{},{segment:d.chain[t]})},u=i();d.chain[t].clearWatcher=n.$watch(i,function(e){e!=u&&(u=e,d.chain[t].reload())})}return{success:t}},function(n){if(c.resolveFailed){var a={error:function(){return r.when(n)}};return g(t,o,e.extend({resolve:a},c.resolveFailed))}throw new Error("Resolving failed with a reason `"+n+"`, but no `resolveFailed` provided for segment `"+o+"`")})}function p(t){d.$routeParams=e.copy(s),d.name="";for(var r=0;r<d.chain.length;r++)d.chain[r]&&(d.name+=d.chain[r].name+".");d.name=d.name.substr(0,d.name.length-1),n.$broadcast("routeSegmentChange",{index:t,segment:d.chain[t]||null})}function v(e,n){if(!n)return null;if(e>=n.length)return null;for(var r,a=o,i=0;i<=e;i++)void 0!=a[t(r=n[i])]&&(a=a[t(r)]),i<e&&(a=a.children);return{name:r,params:a.params,children:a.children}}var d={name:"",$routeParams:e.copy(s),chain:[],startsWith:function(e){return new RegExp("^"+e).test(d.name)},contains:function(e){for(var n=0;n<this.chain.length;n++)if(this.chain[n]&&this.chain[n].name==e)return!0;return!1},getSegmentUrl:function(n,t){var r,a,i;if(!c[n])throw new Error("Can not get URL for segment with name `"+n+"`");t=e.extend({},s,t||{}),r=c[n];for(a in t){var o=new RegExp(":"+a+"[*?]?","g");r=r.replace(o,t[a])}if(r=r.replace(/\/\:.*?\?/g,""),i=r.match(/\/\:([^\/]*)/))throw new Error("Route param `"+i[1]+"` is not specified for route `"+c[n]+"`");return r}},$={};return n.$on("$routeChangeSuccess",function(e,n){var t=n.$route||n.$$route;if(t&&t.segment){for(var a=t.segment.split("."),i=[],o=-1,u=0;u<a.length;u++){var c=v(u,a);($[u]!=c.name||i.length>0||h(c))&&(d.chain[u]&&d.chain[u].name==c.name&&0==i.length&&!h(c)?$[u]=c.name:(i.push({index:u,newSegment:c}),o=u))}var l=r.when();if(i.length>0)for(u=0;u<i.length;u++)!function(e){l=l.then(function(){return f(i[e].index,i[e].newSegment)}).then(function(n){if(void 0!=n.success){p(n.success);for(var t=i[e].index+1;t<d.chain.length;t++)d.chain[t]&&(d.chain[t].clearWatcher&&d.chain[t].clearWatcher(),d.chain[t]=null,f(t,null))}})}(u);l.then(function(){if(d.chain.length>a.length){var e=d.chain.length,n=d.chain.length-a.length;d.chain.splice(-n,n);for(var t=a.length;t<e;t++)f(t,null),o=d.chain.length-1}}).then(function(){var e=r.when();if(o==d.chain.length-1)for(var n=v(o,d.name.split("."));n;){var t=n.children,a=o+1;n=null;for(var i in t)!function(t,r,a){r[t].params.default&&(e=e.then(function(){return f(a,{name:r[t].name,params:r[t].params}).then(function(e){e.success&&p(e.success)})}),n=r[t],o=a)}(i,t,a)}return e})}}),d}]}]),n.filter("routeSegmentUrl",["$routeSegment",function(e){var n=function(n,t){return e.getSegmentUrl(n,t)};return n.$stateful=!0,n}]),n.filter("routeSegmentEqualsTo",["$routeSegment",function(e){var n=function(n){return e.name==n};return n.$stateful=!0,n}]),n.filter("routeSegmentStartsWith",["$routeSegment",function(e){var n=function(n){return e.startsWith(n)};return n.$stateful=!0,n}]),n.filter("routeSegmentContains",["$routeSegment",function(e){var n=function(n){return e.contains(n)};return n.$stateful=!0,n}]),n.filter("routeSegmentParam",["$routeSegment",function(e){var n=function(n){return e.$routeParams[n]};return n.$stateful=!0,n}])}(angular),function(e){e.module("view-segment",["route-segment"]).directive("appViewSegment",["$route","$compile","$controller","$routeParams","$routeSegment","$q","$injector","$timeout","$animate",function(e,n,t,r,a,i,o,u,c){return{restrict:"ECA",priority:400,transclude:"element",compile:function(e,n){return function(e,t,r,i,o){function l(){g&&(c.cancel(g),g=null),m&&(m.$destroy(),m=null),h&&((g=c.leave(h))&&g.then(function(){g=null}),h=null)}function s(n){p=n;var r=e.$new(),a=o(r,function(e){n&&e.data("viewSegment",n),c.enter(e,null,h||t),l()});h=a,(m=r).$emit("$viewContentLoaded"),m.$eval(v)}var m,h,f,g,p={},v=n.onload||"",d=parseInt(n.appViewSegment);a.chain[d]?f=u(function(){s(a.chain[d])},0):s(),e.$on("routeSegmentChange",function(e,n){f&&u.cancel(f),n.index==d&&p!=n.segment&&s(n.segment)})}}}}]),e.module("view-segment").directive("appViewSegment",["$route","$compile","$controller",function(n,t,r){return{restrict:"ECA",priority:-400,link:function(n,a){var i=a.data("viewSegment")||{},o=e.extend({},i.locals),u=o&&o.$template;u&&a.html(u);var c=t(a.contents());if(i.params&&i.params.controller){o.$scope=n;var l=r(i.params.controller,o);i.params.controllerAs&&(n[i.params.controllerAs]=l),a.data("$ngControllerController",l),a.children().data("$ngControllerController",l)}c(n)}}}])}(angular);